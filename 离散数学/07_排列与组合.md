# 第7章 排列与组合

## 7.1 加法法则与乘法法则

### 7.1.1 加法法则

如果完成一件事有n类不同的方法，第i类方法有mᵢ种方式，则完成这件事共有m₁+m₂+...+mₙ种方式。

**例7.1.1** 从北京到上海，可以乘飞机、火车或汽车，分别有4班、6班、3班，则共有4+6+3=13种方式。

### 7.1.2 乘法法则

如果完成一件事需要n个步骤，第i个步骤有mᵢ种方式，则完成这件事共有m₁×m₂×...×mₙ种方式。

**例7.1.2** 从北京经上海到广州，北京到上海有3种方式，上海到广州有4种方式，则共有3×4=12种方式。

## 7.2 排列与组合

### 7.2.1 排列

#### 7.2.1.1 相异元素的排列

**定义7.2.1** 从n个不同元素中取出r个元素按一定顺序排成一列，称为从n个不同元素中取出r个的**排列**。

- **选排列数**：P(n,r) = n!/(n-r)! （r≤n）
- **全排列数**：P(n,n) = n!

**例7.2.1** 从5个不同元素中选3个进行排列：P(5,3) = 5!/(5-3)! = 5!/2! = 60

#### 7.2.1.2 重复排列

从n个不同元素中选r个进行重复排列，共有n^r种方式。

**例7.2.2** 用0,1,2,3这4个数字组成3位数（可重复使用）：4^3 = 64种方式

### 7.2.2 组合

#### 7.2.2.1 相异元素的组合

**定义7.2.2** 从n个不同元素中取出r个元素组成一组，称为从n个不同元素中取出r个的**组合**。

**组合数**：C(n,r) = n!/(r!(n-r)!) = (n r)

**性质**：
1. C(n,r) = C(n,n-r)
2. C(n,r) + C(n,r-1) = C(n+1,r) （Pascal恒等式）
3. C(n,0) + C(n,1) + ... + C(n,n) = 2^n
4. C(n,0) - C(n,1) + C(n,2) - ... + (-1)^n C(n,n) = 0

**例7.2.3** 从5个不同元素中选3个组成一组：C(5,3) = 5!/(3!2!) = 10

## 7.3 Stirling近似公式

### 7.3.1 Stirling公式的定义

**定理7.3.1**（Stirling公式）：当n充分大时，
n! ≈ √(2πn) * (n/e)^n

更精确的表达：
n! = √(2πn) * (n/e)^n * e^(θ/(12n))，其中0 < θ < 1

### 7.3.2 应用

Stirling公式在大数近似计算、概率论和算法分析中有重要应用。

## 7.4 排列的生成算法

### 7.4.1 字典序法生成全排列

字典序排列的性质：
- 相邻字典序排列之间差异最小
- 任意两个排列之间都有确定的顺序

**算法步骤**：
1. 找最大的下标i，使得A[i] < A[i+1]
2. 找最大的下标j，使得A[i] < A[j]
3. 交换A[i]和A[j]
4. 逆转A[i+1]到A[n]的元素

### 7.4.2 Johnson-Trotter算法

该算法通过移动元素来生成所有排列，每个排列只通过相邻元素的交换从上一个排列得到。

## 7.5 组合的生成算法

### 7.5.1 二进制法生成组合

利用二进制数表示组合，n位二进制数中恰有r个1的数对应从n个元素中选r个的组合。

### 7.5.2 递归法生成组合

从n个元素中选r个的组合可以分解为：
1. 不含第n个元素的r元组合（从前n-1个元素中选r个）
2. 含第n个元素的r元组合（从后n-1个元素中选r-1个，再加第n个元素）

## 7.6 可重组合

### 7.6.1 可重排列

#### 7.6.1.1 无限可重排列

从n种不同元素中取r个进行排列，允许重复出现，则共有n^r种方式。

#### 7.6.1.2 有限可重排列

设第i种元素有kᵢ个，从这些元素中取出r个进行排列。

### 7.6.2 可重组合

**定义7.6.1** 从n种不同元素中取出r个的**可重组合**，元素可以重复选取。

**可重组合数**：H(n,r) = C(n+r-1, r)

**证明**：将问题转化为从n+r-1个元素中选r个的普通组合问题（隔板法）。

**例7.6.1** 从3种不同水果中选5个，允许重复：H(3,5) = C(3+5-1, 5) = C(7,5) = 21

## 7.7 若干等式及其组合意义

### 7.7.1 Pascal恒等式

C(n,r) = C(n-1,r) + C(n-1,r-1)

**组合意义**：从n个元素中选r个，可以分为含特定元素和不含特定元素两类。

### 7.7.2 二项式定理

(a+b)^n = Σ_{k=0}^n C(n,k) * a^(n-k) * b^k

**推论**：
1. 2^n = Σ_{k=0}^n C(n,k)
2. 0 = Σ_{k=0}^n (-1)^k * C(n,k)

### 7.7.3 范德蒙德卷积

C(m+n, r) = Σ_{k=0}^r C(m,k) * C(n, r-k)

## 7.8 多项式系数

### 7.8.1 多项式系数的定义

将n个不同的球分配到k个不同的盒子中，使得第i个盒子恰好有nᵢ个球的方式数为：

C(n; n₁, n₂, ..., nₖ) = n!/(n₁!n₂!...nₖ!)

其中n₁ + n₂ + ... + nₖ = n

### 7.8.2 多项式定理

(x₁ + x₂ + ... + xₖ)^n = Σ C(n; n₁, n₂, ..., nₖ) * x₁^n¹ * x₂^n² * ... * xₖ^nᵏ

其中求和遍历所有满足n₁ + n₂ + ... + nₖ = n的非负整数组(n₁, n₂, ..., nₖ)。

## 7.9 错排问题

### 7.9.1 错排的定义

**定义7.9.1** 1到n的排列中，若没有一个元素出现在其自然位置上，则称为**错排**。

### 7.9.2 错排数的计算

**定理7.9.1** n个元素的错排数为：
D(n) = n! * Σ_{k=0}^n (-1)^k / k! ≈ n! / e

当n充分大时，D(n) ≈ n! / e，其中e是自然对数的底。

**递推公式**：D(n) = (n-1)[D(n-1) + D(n-2)]

**例7.9.1** 4个元素的错排数：D(4) = 4!(1/0! - 1/1! + 1/2! - 1/3! + 1/4!) = 24(1-1+1/2-1/6+1/24) = 9

## 7.10 母函数方法

### 7.10.1 普通母函数

序列{a₀, a₁, a₂, ...}的**普通生成函数**为：
G(x) = a₀ + a₁x + a₂x² + ... = Σ aₙxⁿ

**例7.10.1** 常序列{1, 1, 1, ...}的生成函数为1/(1-x)

### 7.10.2 指数母函数

序列{a₀, a₁, a₂, ...}的**指数生成函数**为：
E(x) = a₀ + a₁x/1! + a₂x²/2! + ... = Σ aₙxⁿ/n!

## 本章小结

1. 加法法则和乘法法则是计数的基本原理
2. 排列关注元素的顺序，组合不关注顺序
3. Stirling公式给出阶乘的近似值
4. 有多种算法生成排列和组合
5. 可重组合和可重排列扩展了基本计数问题
6. 二项式系数有许多重要的性质和应用
7. 错排问题是一个经典的组合计数问题

## 课后练习

### 选择题

1. 从5个不同元素中选3个的组合数为：
   A. 10
   B. 20
   C. 60
   D. 120

2. 用1, 2, 3, 4, 5这5个数字组成无重复的3位偶数，共有：
   A. 24个
   B. 36个
   C. 48个
   D. 60个

3. 6个人围成一圈，共有多少种排法？
   A. 720
   B. 120
   C. 60
   D. 30

### 解答题

1. 证明组合数的对称性质：C(n,r) = C(n, n-r)

2. 有5名男生和4名女生排成一排，要求女生必须相邻，问有多少种排法？

3. 用0, 1, 2, 3, 4, 5这六个数字组成无重复的4位数，且能被5整除，问有多少个？

4. 求(1+x+x²)^6的展开式中x⁴的系数。

5. 有5本不同的数学书，4本不同的物理书，要排在书架上，使得同类书相邻，问有多少种排法？

### 练习题答案

#### 选择题

1. A - C(5,3) = 5!/(3!2!) = 120/12 = 10
2. A - 个位必须是2或4，有2种选择，十位有4种选择，百位有3种选择，共2×4×3=24个
3. B - n个人围成一圈的排法为(n-1)!，所以是5!=120（这里应该是(6-1)!=5!=120，答案B正确）

#### 解答题

1. 证明：
   方法一：直接计算
   C(n,r) = n!/(r!(n-r)!)
   C(n,n-r) = n!/((n-r)!(n-(n-r))!) = n!/((n-r)!r!) = n!/(r!(n-r)!)
   所以C(n,r) = C(n,n-r)
   
   方法二：组合意义
   从n个元素中选r个等价于从n个元素中选(n-r)个不选
   所以C(n,r) = C(n,n-r)

2. 解：
   将4名女生看作一个整体，与5名男生共6个对象排成一排，有6!种排法
   4名女生内部有4!种排法
   所以总的排法数为6! × 4! = 720 × 24 = 17280种

3. 解：
   4位数能被5整除，个位必须是0或5
   分两类：
   (1) 个位是0：前3位从{1,2,3,4,5}中选3个排列：P(5,3) = 60个
   (2) 个位是5：千位不能是0，从{1,2,3,4}中选1个，十位和百位从{0}并上{剩余3个数}中选2个：4×P(4,2) = 4×12 = 48个
   总共：60+48=108个

4. 解：
   (1+x+x²)^6 = Σ C(6; i,j,k) 1^i x^j (x²)^k = Σ C(6; i,j,k) x^(j+2k)
   其中i+j+k=6，且j+2k=4
   所以i=6-j-k=6-j-(4-j)/2=6-j/2-2=4-j/2
   必须j是偶数且j+2k=4，i+j+k=6
   当j=0, k=2, i=4：C(6;4,0,2) = 6!/(4!0!2!) = 15
   当j=2, k=1, i=3：C(6;3,2,1) = 6!/(3!2!1!) = 60
   当j=4, k=0, i=2：C(6;2,4,0) = 6!/(2!4!0!) = 15
   系数 = 15 + 60 + 15 = 90

5. 解：
   数学书看成一个整体，物理书看成一个整体
   两个整体的排列有2!种
   数学书内部排列有5!种
   物理书内部排列有4!种
   总排法：2! × 5! × 4! = 2 × 120 × 24 = 5760种